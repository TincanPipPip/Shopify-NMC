<ul class="menu" id="SiteNav">
    {% for link in linklists[linklist].links %}
        {%- assign child_list_handle = link.title | handleize -%}
        {% if link.links != blank %}
            {% if link.levels == 2 %}
                {%- assign three_level_nav = true -%}
            {% endif %}
        {% endif %}
        {% if link.links != blank %}
            <li class="menu-item menu-item--collapsed {% if link.active %} menu-item--active-trail{% endif %}" data-has-dropdowns>
                <button aria-controls="SiteNavLabel-{{ child_list_handle }}" aria-expanded="false" class="menu-item menu-item__link" type="button">
                    <span class="site-nav__label">{{ link.title | escape }}</span>
                    {% include 'icon-chevron-down' %}
                </button>
                <div class="site-nav__dropdown{% if three_level_nav %} site-nav__dropdown--centered{% endif %}" id="SiteNavLabel-{{ child_list_handle }}">
                    {% if three_level_nav %}
                        <div class="site-nav__childlist">
                            <ul class="site-nav__childlist-grid">
                                {% if link.links != blank %}
                                    {% for childlink in link.links %}
                                        <li class="site-nav__childlist-item">
                                            <a href="{{ childlink.url }}" class="site-nav__link site-nav__child-link site-nav__child-link--parent" {% if childlink.current %} aria-current="page" {% endif %}>
                                                <span class="site-nav__label">{{ childlink.title | escape }}</span>
                                            </a>
                                            {% if childlink.links != blank %}
                                                <ul>
                                                    {% for grandchildlink in childlink.links %}
                                                        <li>
                                                            <a href="{{ grandchildlink.url }}" class="site-nav__link site-nav__child-link" {% if grandchildlink.current %} aria-current="page" {% endif %}>
                                                                <span class="site-nav__label">{{ grandchildlink.title | escape }}</span>
                                                            </a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </div>
                    {% else %}
                        <ul>
                            {% for childlink in link.links %}
                                <li>
                                    <a href="{{ childlink.url }}" class="site-nav__link site-nav__child-link{% if forloop.last %} site-nav__link--last{% endif %}" {% if childlink.current %} aria-current="page" {% endif %}>
                                        <span class="site-nav__label">{{ childlink.title | escape }}</span>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </li>
        {% else %}
            <li class="menu-item">
                <a href="{{ link.url }}" class="menu-item menu-item__link" {% if link.current %} aria-current="page" {% endif %}>
                    <span class="site-nav__label">{{ link.title | escape }}</span>
                </a>
            </li>
        {% endif %}
    {% endfor %}
</ul>